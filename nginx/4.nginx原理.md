- #### 事件驱动架构
```
1.事件驱动架构：就是由一些事件发生源来产生事件，由一个或者多个事件收集器来收集、分发事件，
  然后许多事件处理器会注册感兴趣的事件，同时会“消费”这些事件
2.nginx采用完全的事件驱动架构来处理业务，与传统的web服务器是不同的，传统的web服务器会把一个进程或线程作为事件消费者，
  当一个请求产生的事件被该进程处理时，直到这个请求处理结束时进程资源都将被请求占用
3.nginx不会使用进程或线程来作为事件消费者，事件消费者其实就是nginx的某个模块，
  只有事件收集、分发器才有资格占用进程资源，它们会在分发某个事件时调用事件消费模块使用当前占用的进程资源
4.传统web服务器与nginx间的重要差别：
  * 前者是每个事件消费者独占一个进程资源，后者的事件消费者只是被事件分发者进程短期调用而已
  * 这种设计使得网络性能、用户感知的请求时延都得到了提升，每个用户的请求所产生的事件会及时响应，整个服务器的网络吞吐量都会由于事件的及时响应而增大
```

- #### 请求多阶段异步处理
```
1.请求的多阶段异步处理只能基于事件驱动架构实现，就是把一个请求的处理过程按照事件的触发方式划分为多个阶段，
  每个阶段都可以由事件收集、分发器来触发
2.请求的多阶段异步处理的优势在于：
  * 配合事件驱动架构，将会极大的提高网络性能，同时使得每个进程都能全力运转，不会或者尽量少的出现进程休眠状况
  * 休眠进程的出现，必然减少并发处理事件的数目，一定会降低网络性能，同时增加请求处理时间的平均延时
3.划分请求阶段的原则是，一般找到请求处理流程中的阻塞方法（或是造成阻塞的代码段），在阻塞代码段上按照4种方式来划分阶段：
  * 将阻塞进程的方法按照相关的触发事件分解为两个阶段
    大多数情况下，一个阻塞进程的方法调用时可以划分为两个阶段：
    > 阻塞方法改为非阻塞方法调用，这个调用非阻塞方法并将进程还给事件分发器的阶段就是第一阶段
    > 增加新的处理阶段（第二阶段）用于处理非阻塞方法最终返回的结果，结果返回事件就是第二阶段的触发事件
  * 将阻塞方法调用按照时间分解为多个阶段的方法调用
    系统中的事件收集、分发者并非可以处理任何事件，如果按照触发事件划分的某个方法，可能不能够被事件收集、分发器所处理，
    这时，只能按照执行时间来拆分方法
    > 如读取文件的调用（非异步I/O），读取10MB的文件，这些文件在磁盘中的块未必是连续的，当这10M文件内容不在操作系统缓存中是，
      可能需要多次驱动硬盘寻址
  * 在“无所事事”且必须等待系统的响应，从而导致进程空转时，使用定时器划分阶段
  * 如果阻塞方法完全无法继续划分，则必须使用独立的进程执行这个阻塞方法
```

- #### 管理进程&多工作进程
```
1.nginx采用一个master管理进程、多个worker工作进程的设计方式有以下优点：
  * 利用多核系统的并发处理能力
    > 现代操作系统已经支持多核CPU架构，这使得多个进程可以占用不同的CPU核心来工作
  * 负载均衡
    > 多个worker工作进程间通过进程间通信来实现负载均衡，一个请求到来时更容易被分配到负载较轻的worker工作进程中处理 
  * 管理进程会负责监控工作进程的状态，并负责管理其行为
    > 管理进程不会占用多少系统资源，只用来启动、停止、监控或使用其他行为来控制工作进程
    > 管理进程支持nginx服务运行中的程序升级、配置项的修改等操作，这种设计使得动态可扩展性、动态定制性、动态可进化性较容易实现
2.worker进程如何工作
  * master进程是通过进程间通信的方式控制worker进程运行的，nginx采用的是信号
  * worker进程会有一个方法来处理信号，就是ngx_signal_handler方法
  * worker进程接收到信号对框架的意义
    > QUIT：优雅的关闭进程
    > TERM或INT：强制关闭进程
    > USR1：重新打开所有文件
    > WINCH：目前没有实际意义
3.master进程如何工作
  * master进程不需要处理网络事件，它不负责业务的执行、只会通过管理worker等子进程来是想重启服务、平滑升级、更换日志文件、配置文件生效等功能
  * master进程会通过检查7个标志位来决定ngx_master_process_cycle方法的运行
    > QUIT：优雅的关闭整个服务
    > TERM或者INT：强制关闭整个服务
    > USR1：重新打开服务中的所有文件
    > WINCH：所有子进程不在接受处理新的连接，实际相当于对所有的子进程发送QUIT信号量
    > USR2：平滑升级到新版本的nginx程序
    > HUP：重读配置文件并使服务对新配置项生效
    > CHLD：有子进程意外结束，需要监控所有的子进程，即ngx_reap_children方法所做的工作
``` 

- #### 事件模块
```
1.事件处理框架解决的问题是如何收集、管理、分发事件，事件主要以网络事件和定时器事件为住，
  而网络事件中又以TCP网络事件为主
2.事件处理框架需要在不同的操作系统内核中选择一种事件驱动机制支持网络事件的处理，epoll是目前Linux系统最强大的事件管理机制
3.epoll事件驱动模块
  * 假如有100万用户同时与一个进程保持着TCP连接，而每一时刻只有数量很少的TCP连接是活跃的
    > select和poll，每次收集事件时，都把100万连接的套接字传给操作系统，而由操作系统内核寻找这些连接上有没有事件发生，资源浪费巨大
    > epoll会在Linux内核申请一个简易的文件系统，把原先的一个select或poll调用分成3个部分：
      调用epoll_create建立1个epoll对象
      调用epoll_ctl向epoll对象中添加100完个连接的套接字
      调用epoll_wait收集发生事件的连接
4.epoll有两种工作模式：LT（水平触发）模式和ET（边缘触发）模式
  * 默认情况下，epoll采用LT模式工作，可以处理阻塞和非阻塞套接字
  * ET模式的效率要比LT模式高，但只支持非阻塞套接字
```