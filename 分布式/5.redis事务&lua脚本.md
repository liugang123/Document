- #### 事务
```
1.Redis事务提供里一种将多个命令请求打包，然后一次性、按顺序地执行多个命令的机制，
  并且在事务执行期间，服务器不会中断事务去执行其他的客户端命令，多个并非的事务也是串行执行的
2.事务的实现
* 事务开始：multi命令的执行标志事务的开始，将客户端状态从非事务状态切换至事务状态
  1)客户端在非事务状态下，客户端发送的命令会被立即执行
  2)客户端在事务状态下，客户端发送的常规命令会被放入事务队列，不包括事务相关的命令，如exec、discard、watch、multi
* 命令入队：事务队列以先进献出(FIFO)的方式保存入队的命令
* 事务执行：exec命令用来提交事务，
          当exec命令被执行时，服务器会遍历保存在客户端的事务队列，执行队列中的命令，将所有命令的执行结果返回给客户端
3.乐观锁(optimistic locking)
  watch命令可以监视任意数量的数据库键，在exec命令执行时，检查被监视的键是否已经被修改，
  如果键已修改，就拒绝执行当前事务，向客户端返回执行事务失败的空回复
4.事务特性
* Redis的事务总是具有ACID中的原子性、一致性和隔离性，当服务器运行在AOF持久化模式下，并且appendfsync选项为always时，事务也具有持久性
* Redis事务和传统的关系型数据库最大的区别，是Redis不支持事务回滚机制，事务队列的某个命令执行错误，整个事务也会继续执行，直到所有命令执行完毕
* Redis不支持事务回滚是因为回滚的功能和redis追求简单高效的设计主旨不相符，同时，事务执行时的错误通常是编程错误的产生，生产环境很少出现
```

- #### Lua脚步
```
1.通过在服务器中嵌入Lua环境，Redis客户端可以使用Lua脚本，直接在服务端原子性的执行多个Redis命令
2.Reids创建了两个和Lua环境进行协作的组件：
* 伪客户端：负责执行Lua脚本，处理脚本中包含的redis命令
  Lua脚本使用redis.call函数来执行一个Redis命令
* lua_scripts字典：负责保存lua脚本
  字典键为某个lua脚本的sha1校验和
  字典值为sha1校验和对应的lua脚本
3.eval命令
* 根据客户端给定的lua脚本，在lua环境中定义相应的lua函数
* 将客户端脚本保存到lua_scripts字典中
* 执行lua环境中定义的函数，以此来执行客户端的lua脚本
4.evalsha命令
客户端可以根据脚本的sha1校验和值来执行对应的lua脚本，只要脚本之前在lua环境中定义过，就可以在lua_scripts字典中找到对应的脚本
5.脚本管理命令
* script flush命令：清除服务器所有和lua脚本有关的信息，释放并重建lua_script字典，关闭现有的lua环境创建新lua环境
* script exists命令：检查校验和值对应的脚本是否存在服务器中，通过lua_script字典实现
* script load命令：先在lua环境中创建相应的函数，在将脚本保存到lua_script字典中，与eval命令的前两步一样 
* script kill命令：停止执行脚本
```