- #### 数据库
```
1.redis服务器将所有的数据库都保存在服务器redisServer结构成员db数组中，
  db数组的每一项都是一个redisDb结构，每个redisDb结构代表一个数据库
2.服务器redisServer结构定义：
typedef struct redisServer {
    // 数组保存服务器中的所有数据库
    redisDb *db;
    // 服务器的数据库数量
    int dbnum;
}
dbnum属性决定创建数据库的数量，由服务器配置的database选项决定，默认值为16
3.每个redis客户端都有自己的目标数据库，每当客户端执行数据库命令时，目标数据库就成为这些命令的操作对象
4.客户端redisClient结构定义：
typedef struct redisClient {
   // 指向redisDb结构的指针，记录客户端当前正在使用的数据库
   redisDb *db;
} redisClient;
客户端可以通过select命令来切换数据库
```

**db相关命令**

命令 | 描述
---|---
select index | 切换到指定的数据库
flushall | 删除所有数据库的所有key
flushdb | 删除当前数据库的所有key
dbsize | 返回当前数据库的key总数

- #### 键空间
```
1.Reids是一个键值对数据库，表示数据库redisDb结构中的字典保存了所有键值对，将这个字典称为键空间
2.键空间结构定义：
typedef struct redisDb {
    // 数据库键空间，保存数据库中的所有键值对
    dict *dict;
} redisDb;
键空间和用户所见的数据库直接对应：
* 键空间的键为数据库的键，每个键是一个字符串
* 键空间的值为数据库的值，每个值可以是任意一种类型的redis对象
3.所有针对键值对的操作都是通过对键空间进行操作来完成的：
* 添加新键：将新键值对添加到键空间字典中
* 删除键：在键空间里删除键所对应的键值对对象
* 更新键：对键空间里键所对应的值对象进行更新
* 对键取值：在键空间中取出键所对应的值对象
* 清空数据库：通过删除键空间中的所有键值对来实现
* 键总数：通过计算键空间中包含的键值对的数量实现
```

- #### 键的生存周期
```
1.客户端可以以秒或毫秒为单位设置某个键的生存时间，在经过指定的秒或毫秒数，服务器会自动删除生存时间为0的键
2.Redis提供了4种不同的方式设置键的过期时间：
* expire key ttl：将key的生存时间设置为ttl秒 
* pexpire key ttl：将key的生存时间设置为ttl毫秒
* expireat key timestamp：将key的过期时间设置为timestamp所指定的秒数时间戳
* pexpireat key timestamp：将key的过期时间设置为timestamp所指定的毫秒数时间戳
其他的3个命令最终都可以转化为pexpireat命令，执行效果一样
3.过期字典：reidsDb结构的expire字典保存了数据库中所有键的过期时间
typedef struct redisDb {
  // 过期字典，保存键的过期时间  
} redisDb;
* 过期字典键：一个指向键空间中的某个键对象的指针
* 过期字典值：long类型的整数，一个毫秒精度的unix时间戳，保存了数据库键的过期时间
4.移除过期时间：persist命令在过期字典中查找给定的键，并解除键和值在过期字典中的关联
5.计算剩余时间：
* ttl命令：以秒为单位返回键的剩余生存时间
* pttl命令：以毫秒为单位返回键的剩余生存时间
```

- #### 过期键删除策略
```
1.定时删除：在设置键的过期时间的同时，创建一个定时器，在键过期时间来临时，定时器立即执行对象删除操作
* 优点：保证过期键会尽可能快的被删除，并释放过期键所占用的内存
* 缺点：占有太多CPU时间，影响服务器的响应时间和吞吐量
2.惰性删除：放任键过期不管，只有在获取键的时候，才查看键是否过期，进行删除操作
* 优点：对cpu最友好，在必要的时候才进行过期键删除
* 缺点：浪费太多内存，有内存泄漏的危险
3.定期删除：每隔一段时间，对数据库进行一次检查，删除过期键
  通过限制删除操作执行的时长和频率减少删除操作对cpu的影响
  通过定期删除键有效的减少了过期键带来的内存浪费
4.Redis过期键删除策略：
  使用惰性删除和定期删除两种策略来删除过期键，惰性删除只在碰到过期键时才进行删除操作，
  定期删除则每隔一段时间主动查找并删除过期键
```

**key相关命令**

命令 | 描述
---|---
del key | 在key存在时删除key 
exists key | 检查给定key是否存在 
type key | 返回key所存储的值的类型
expire key seconds | 为给定key设置过期时间，以秒为单位
pexpire key milliseconds | 为给定key设置过期时间，以毫秒为单位
ttl key | 已秒为单位，返回key的剩余过期时间
pttl key | 已毫秒为单位，返回key的剩余过期时间 
rename key newkey | 修改key的名称
renamenx key newkey | 仅当newkey不存在时，将key更名为newkey