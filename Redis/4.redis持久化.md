- #### RDB持久化
```
1.数据库状态:服务器中的非空数据库以及库中的键值对统称为数据库状态
2.RDB持久化：redis是内存数据库，数据库状态被保存在内存中，为避免数据意外丢失，RDB持久化可以将数据库的状态保存在磁盘中
3.生成RDB文件：
* save命令：会阻塞redis进程，直到RDB文件创建完毕为止，服务器不能处理任何命令请求
* bgsave命令：派生出一个子进程负责创建RDB文件，服务器进程继续处理命令请求
4.RDB文件还原数据库状态：
Redis在启动时，检测到RDB文件存在，就会自动载入RDB文件，没有专门的载入命令
5.自动间隔性保存：
用户可以通过save选项设置多个保存条件，只要其中任意一个条件被满足，服务器就会执行bgsave命令
6.RDB文件结构：
RDB文件是一个结果压缩的二进制文件，由多个部分组成，对于不同类型的键值对，RDB会使用相应的方式进行保存
```

- #### AOF持久化 
```
1.AOF持久化：通过保存Redis服务器所执行的写命令来记录数据库状态
2.AOF文件写入与同步：
* 在服务器执行完写命令时，一些内容会被追加到aof_buf缓冲区，每次命令执行结束之前，
都会调用flushAppendOnlyFile函数，考虑是否将aof_buf缓冲区的内容写入到AOF文件以及对AOF文件进行同步
* 通过对服务器appendfsync选项的设置可以控制AOF的写入和同步：
  Redis的appendfsync选项的默认值是everysec
3.AOF文件还原数据库状态：
服务器只要读入并重新执行AOF的命令，就可以还原关闭之前的数据库状态
4.AOF重写：
* 不需要对现有的AOF文件进行任何的读取、分析或写入操作，只需通过读取数据库中的键值对来实现
* aof_rewrite函数用于生成新的AOF文件，并且只包含数据库状态必须的命令，不会造成磁盘空间的浪费
5.AOF后台重写：
* 命令bgrewriteaof命令用于AOF后台重写
* 在子进程创建新的AOF文件期间，Redis会维护一个AOF的重写缓冲区，用来记录服务器的所有写命令，
  当子进程创建完新的AOF文件后，服务器会将AOF重写缓冲区的内容追加到新的AOF文件中，最后在替换旧的AOF文件，保持数据库状态的一致
```

**appendfsync选项的设置**

选项值 | flushAppendOnlyFile函数行为
---|---
always |  将aof_buf缓冲区中的所有内容写入并同步到AOF文件
everysec | 将aof_buf中的内容写入到AOF文件，如果距离上次同步的时间超过1秒，<br>就再次对AOF文件进行同步，并且同步操作由操作由另外的线程完成 
no | 将aof_buf缓冲区内容写入AOF文件，对AOF文件的同步由操作系统来决定

- #### 事件
```
1.Redis服务是事件驱动程序，服务器需要处理两类事件：
* 文件事件：是服务器对套接字操作的抽象，服务器和客户端通信会产生相应的文件事件，服务器通过监听并处理文件事件来完成网络通信的操作
* 时间事件：服务器对程序定时操作的抽象
2.文件事件
* 使用I/O多路复用程序来同时监听多个套接字，并根据套接字的任务关联不同的事件处理器
* 每次套接字变为(acceptable)、可写(writable)或可读(readable)时，相应的文件事件就会产生
* I/O多路复用程序会将所有事件的套接字都放到一个队列里，然后以有序的、同步、每次一个套接字的方式向事件分派器传送套接字，避免并发引起的问题
3.文件事件分为：ae_readable事件(读事件)和ae_writabl事件(写事件)
4.文件事件处理器：
* 连接应答处理器：用于对连接服务器监听套接字的客户端进行应答
* 命令请求处理器：负责从套接字中读入客户端发送的命令请求内容
* 命令回复处理器：负责将服务器执行命令后得到的命令回复通过套接字返回给客户端
5.时间事件
* 定时事件：程序在指定的时间之后执行一次
* 周期性事件：程序每隔指定的时间就执行一次
6.时间事件实例：serverCron函数
serverCron函数负责定期对服务器资源和状态进行检查和调整，从而确保服务器长期、稳定的运行，serverCron的主要工作包括：
* 更新数据库的各类统计信息，如时间、内存占用、数据库占用情况
* 清理数据库中的过期键值对
* 关闭和清理连接失效的客户端
* 尝试进行AOF或RDB持久化操作
* 如果服务器是主服务器，对从服务器进行定期同步
* 如果处于集群模式，对集群进行定期同步和连接测试
```