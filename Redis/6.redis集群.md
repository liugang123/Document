- #### 复制
```
1.通过执行slaveof命令或者设置slavof选项，让一个服务器去复制另一个服务器，复制中主从服务器双方的数据库数据将保持一致
2.主服务器(master):被复制的服务器称为主服务器
3.从服务器(slave):对主服务器进行复制的服务器称为从服务器
4.主服务器可以处理客户端的读写命令，从服务器只能处理读命令
```

- #### 实现复制
```
1.复制功能需要就行两个操作：
* 同步：用于将从服务器的数据库状态更新至主服务器当前所处的数据库状态
  (1)从服务器向主服务器发送sync命令
  (2)收到sync命令主服务器执行bgsave操作，在后台生成rdb文件，并在缓存区记录之后所有的写命令
  (3)主服务将rdb文件发送给从服务器，从服务器载入rdb文件，更新数据库状态至主服务器执行bgsave操作时的数据状态
  (4)主服务器将缓存区的写命名发送给从服务器，从服务器执行写密码，将数据库状态更新至主服务器的最新状态
* 命令传播：在主服务器的数据库状态被修改时，让主从服务器的数据库从新回到一致状态
  同步操作完成之后，主服务器会将自己执行的写命令发送给从服务期执行，始终保持双方数据库状态的一致
```

- #### 同步模式
```
1.Redis从2.8版本开始，使用psync命令替代sync命令来执行复制同步操作，psync具有两种同步模式：
* 完整重同步：用于处理初次复制，与sync命名执行步骤一样，通过rdb文件和命令缓冲区来进行同步
* 部分重同步：用于断线后复制，主服务器将连接断开期间的写命令发送给从服务器，就可以将从服务器的状态更新至一致状态
2.部分重同步功能由三个部分构成
* 主服务器的复制偏移量和从服务器的复制偏移量
  (1)主服务器每次向从服务器传播N个字节数据时，就讲自己的复制偏移量值加上N
  (2)从服务器每次收到主服务器传播来的N个字节数据时，也将自己的复制偏移量值加上N
  (3)如果主从服务器处于一致状态，两者的偏移量总是相同的
* 主服务器的复制积压缓存区
  (1)主服务器维护一个固定长度先进先出的队列，当入队元素的数量大于队列长度时，最先入队的元素会被弹出，而新元素被放入队列
  (2)如果offset偏移量仍然存在于复制挤压缓存区中，主服务器将进行部分重同步操作，否则，执行完整重同步操作
  (3)复制挤压缓冲区的最小大小可以通过公式估算
     second * write_size_per_second
     second：从服务器断线到重连所需的平均时间
     write_size_per_second：主服务器平均每秒产生的写命令数据量
* 服务器的运行ID
  (1)每个Redis服务器，都会有自己的运行ID，服务器启动时自动生成
  (2)如果主从服务的运行ID相同，主服务器尝试执行部分重同步操作，否则，执行完整重同步操作
3.psync命令调用：
* 如果从服务器没有复制过任何主服务器，将向主服务发送'psync ? -1'命令，主动请求主服务器进行完整重同步
* 如果从服务器复制某个主服务器，将向主服务器发送'psync runid offset',主服务器通过服务器运行ID和offset偏移量来决定执行那种操作
4.psync命令回复：
收到psync命令的主服务器会向从服务器回复其中的一种：
* +fullresync runid offset：执行完整重同步，offset作为自己的初始化偏移量
* +continue：执行部分重同步，主服务器会发送从服务器缺少的部分数据
* -err：redis版本低于2.8，不识别psync命令
```

- #### 心跳检测
```
在命令传播阶段，从服务器会以每秒一次的频率，向服务器发送命令：
replconf ack replication_offset
心跳检测的作用：
* 检测主从服务器的网络连接状态
* 辅助实现min-slaves选项
* 检测命令丢失
```

- #### 哨兵(sentinel)
```
1.哨兵是Redis高可用性的解决方案：由一个或多个sentinel实例组成的Sentinel系统，会监视所有的主服务器及其下属的从服务器，
当主服务器下线时自动将下属的从服务器升级为新的主服务器
2.启动初始化Sentinel
  redis-sentinel /path/to/your/sentinel.conf 或者
  redis-server /path/to/your/sentinel.conf
当sentinel启动时，执行以下步骤：
* 初始化服务器
  sentinel模式下的redis服务器不使用数据操作命令、事务命令、脚本命令、rdb持久化命令，aof持久化命令等
* 将普通redis服务器使用的代码替换成sentinel专用代码
  sentinel一般使用26379作为服务器端口
* 初始化sentinel状态
  服务器会初始化sentinelState结构保存和sentinel功能有关的状态
* 根据给定的配置文件，初始化sentinel监视主服务器的列表
  sentinel状态中的masters字典记录了所有被监视的主服务器信息
* 创建连向主服务器的网络连接
  每个被sentinel监视的主服务器，sentinel会创建两个连向主服务器的异步网络:
  1)命令连接：专门用于向主服务器发送命令，并接受命令回复
  2)订阅连接：订阅主服务器的__sentinel__:hello频道
3.主观下线
4.客观下线
5.选举领头sentinel
6.故障转移
```

- #### 集群
```

```