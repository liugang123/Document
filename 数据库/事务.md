```
事务：构成单一逻辑工作单元的操作集合
```

- #### 数据属性(ACID)
```
原子性(automicity):事务的所有操作在数据库中要么全部正确反映出来，要么完全不反映
一致性(consistency):保证若数据库一开始是一致的，则事务执行后数据库仍处于一致状态
隔离性(isolation):尽管多个事务可能并发执行，但系统保证，对于事务要么在其他事务之前执行，要么在其他事务之后执行，
                 每个事务都感觉不到其他事务在并发的执行
                 数据库的并发控制系统确保事务的隔离性
持久性(durability):一个事务成功完成后，对数据库的改变必须是永久的，即时出现系统故障
```

- #### 事务状态
```
活动状态(active):初始状态，事务执行时处于这个状态
部分提交状态(partially committed):最后一条语句执行后
失败状态(failed):发现正常的执行不能继续后
中止状态(aborted):事务回滚并且数据库已恢复到事开始执行前的状态
提交状态(committed):成功完成后
```

```
graph LR
活动状态-->部分提交状态
活动状态--> 失败状态
部分提交状态-->提交状态
部分提交状态--> 失败状态
失败状态-->终止状态
```
- #### 调度&可串行化
```
描述事务指令执行顺序称为调度
串性的：每个串行调度由来自各事务的指令序列组成，其中属于同一个事务的指令在调度中紧挨在一起
可串性化调度：在并发执行中，保证所执行的任务调度的效果都与没有并发执行的调度效果一样，确保数据库的一致性，调度在某种意义上等价与一个串行调度
可恢复调度：系统发生故障后数据可以正确恢复
级联回滚：单个事务故障导致一系列事务回滚的现象
无级联调度：对于每对事务Ti和Tj，如果Tj读取了先前由Ti所写的数据项，则Ti必须在Tj这一读操作前提交
```

- #### 隔离性级别的实现
```
可以使用多种并发控制机制来保证，即时有多个事务并发执行时，不管操作系统在事务间如何分时共享资源，都只产生可接受调度
锁：一个事务可以封锁其访问的数据项，而不用封锁整个数据库
共享锁：用于事务读的数据项
排他锁：用于事务写的数据项
许多事务可以同时持有一个数据项的共享锁，但只有当其他事务在一个数据项上不持有任何锁时，一个事务才允许持有该数据的排他锁
时间戳：用来确保在访问冲突情况下，事务按照事务时间戳的顺序来访问数据项
数据项的读时间戳记录该数据项的事务的最大（最近）时间戳
数据项的写时间戳记录写入该数据项当前值事务的时间戳
多版本快照隔离：在快照隔离中，每个事务开始时有其自身的数据库版本或快照，更新数据只出现在其私有版本中，
             当事务提交时，和更新相关的信息将保存，使得更新被写入真实的数据库
```

- #### 锁协议
```
为保持事务的隔离性，系统通过并发控制机制来对并发事务之间的相互作用加以控制，最常用的机制有两阶段封锁和快照隔离
1.封锁协议：规定事务何时对数据项们进行加锁、解锁
2.两阶段封锁协议：要求每个事务分两个阶段提出加锁和解锁申请
增长阶段：事务可以获取锁，但不能释放锁
缩减阶段：事务可以释放锁，但不能获取新锁
3.锁转换：提供一种将共享锁升级为排他锁，将排他锁降级为共享锁的机制
锁升级：表示从共享到排他的转换，只能发生在增长阶段
锁降级：表示从排他到共享的转换，只能发生在缩减阶段
4.基于事务的读、写请求，系统自动的为事务加锁、解锁指令：
* 当事务T进行read(Q)操作时，系统产生一条lock-S(Q)指令，该read(Q)指令紧随其后
* 当事务进行write(Q)操作时，系统检查T是否已在Q上持有共享锁
  若有，系统发出upgrade(Q)指令，后接write(Q)指令
  若无，系统发出lock—X(Q)指令，后接write(Q)指令
* 当一个事务提交或中止后，该事务持有的所有锁都被释放 
```



